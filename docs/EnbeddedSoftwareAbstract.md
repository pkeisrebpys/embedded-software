# 組み込みソフトウェアの動作

## プロセッサの構成と動作
プログラムによってコンピュータ内のプロセッサに命令を与え，様々な処理を行わせる。
プロセッサの動作をイメージしながらコードを記述できるよう，プロセッサの構成と動作を示す。
プロセッサの動作をイメージできると演算速度，メモリ量を改善する上でも役立つ。

プロセッサの主要な構成要素は以下。
- 演算装置 プログラムに書かれた命令に応じ，データに対して操作を行う。
- レジスタ 演算装置で使うデータを一時的に保存する。保存容量は小さいが高速動作。
- メモリ データを保存する。レジスタより大容量だが低速。

プロセッサの動作の流れは以下。
1. 命令の読み込み
2. 命令の解釈
3. 命令の実行
4. 実行結果の格納

プロセッサの個々の命令動作について把握するにはプロセッサの命令セットを調べると良い。
アセンブラ言語で書かれたコードを読むこともプロセッサ動作の理解を助ける。

### 命令の読み込み
通常のデータと同じく，プロセッサへの命令もメモリに保存されている。
はじめにメモリから次に実行する命令を読み込む。
読み込む命令が保存されたメモリアドレスはプログラムカウンタと呼ばれる特別なレジスタに保存されている。
プログラムカウンタに示されたアドレスから演算装置に命令を読み込む。
プログラムカウンタは次の命令読み込みに備えて1命令のデータサイズ分だけ加算される。

### 命令の解釈
プロセッサへの命令は以下の2つの部分から構成される。
- オペコード 何の操作をするのかを示す
- オペランド 操作に必要なデータ，レジスタ位置，アドレスなどを示す

演算装置は命令を解釈し，必要に応じてデータをレジスタから読み込む。

### 命令の実行
レジスタから読み込んだデータに対して命令に従った処理を行う。
処理は1クロックで完了するものもあれば，完了までに複数クロックを要するものもある。

### 実行結果の格納
演算処理によって得られたデータを命令で指定されたレジスタに格納する。

## プロセッサの入出力
プロセッサ動作の基本はレジスタからデータを読み込み，処理し，再びレジスタに格納する流れである。
しかしこの流れだけでは以下の問題がある。
- レジスタは小容量であるため大量のデータを扱うことができない。
- プロセッサ内部でデータが動いているだけで外部との入出力できない。

レジスタが小容量であることを解決するため，低速であるが大容量のメモリを用いる。
データは基本的にメモリに格納されている。
命令実行にデータが必要になると，データはメモリからレジスタに読み込まれる。
(メモリからレジスタへの読み込みもプロセッサへの命令として実行される。)
命令が実行されレジスタに格納されたデータは，レジスタからメモリに書き出される。
(レジスタからメモリへの書き出しもプロセッサへの命令として実行される。)
このようにして必要なデータを少しずつレジスタに移しては処理し結果をメモリに書き出すことで，
小容量のレジスタでも大容量のデータを扱うことを実現する。

ここで注意が必要なのはメモリは大容量であるが演算装置の動作に対して非常に遅いことである。
レジスタが演算装置のクロックに





