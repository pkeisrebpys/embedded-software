# お試しプログラム
環境構築が済んだら，まずはお試しプログラムでソフトウェアが組めるか確認する。

## 環境説明
今回の実習では，ソフトウェアで実装した仮想のマイコンを対象に
ソフトウェアを作成し，動作を確認していく。
物理的なマイコンは使用しない[^HardwareDifficulty]。

[^HardwareDifficulty]: 本実習はソフトウェアを学ぶことを主眼に置くため，
ハードウェアを準備し，接続する部分は除外し，
いつでもどこでも実習できるようにした。
組み込みソフトウェアでもハードウェアを仮想化してしまえば，
汎用ソフトウェアと同様，パーソナルコンピュータだけで作業ができる。
逆に，組み込みソフトウェアで面倒な点は，
ハードウェアを準備し，ソフトウェアから正しく操作できるように調整する部分である。
実際の不具合対応においても，可能な限りハードウェアとソフトウェアを分離し，
ソフトウェアは完璧，あとはハードウェアとの接続に問題あり，
と言い切れる状態を目指したい。

今回の仮想マイコンの仕様は以下の通り。

- 外部入力
  - 32 bit デジタル入力 1 点
  - 12 bit アナログ入力 8 点 (-5V から +5V を 0-4095 に変換)
  - シリアル通信 (256 byte 入力リングバッファ付き)
- 外部出力
  - 32 bit デジタル出力 1 点
  - 12 bit アナログ出力 8 点 (0-4095 を -5V から +5V に変換)
  - シリアル通信 (256 byte 出力リングバッファ付き)
- 割り込み
  - 1 ms タイマ割り込み

ソフトウェアは既に外部入出力，割り込みの設定が完了しており，
あとは割り込み関数に記述するのみとなっている。
今回の仮想マイコンでは，
割り込みで実施しないバックグラウンド処理は模擬対象としていない。

## 課題: デジタル出力をためす
本課題では以下の想定でソフトウェアを作成する。

- デジタル出力の 0 bit に LED を接続した
- LED は出力 1 で消灯，0で点灯

このLEDで10ms消灯，10ms点灯を繰り返し，
点滅を実現したい。

今回は他のデジタル出力の状態は問わない。
誤って他のデジタル出力の状態を変更しても接続がなく問題ないとする。

課題ファイルは本リポジトリの `led-blink/interrupt.c` に準備してある。
マイコンの入出力は `include/virtual_microprocessor.h` にまとめてある。
ファイルを編集したら，以下のコマンドでコンパイルする。
`led-blink` フォルダに移動して `make` を実行する。
エラーが表示されたらコードを修正する。
コンパイルが成功したら `make run` で仮想マイコンを動作させる。

実行すると，1msごとのLED点滅状態が `*` と `-` で表示される。
`*` は点灯， `-` は消灯を意味している。

正しいソフトウェアであれば， `*` と `-` が 10 個ずつ繰り返される。

ソフトウェアが正しいことを確認するためのテストを用意した。
`led-blink` フォルダに移動して `make test` を実行する。
ソフトウェアが正しい場合 `OK` を出力して正常に終了する。
ソフトウェアに誤りがある場合，異常があることを示して終了する。

## 課題: デジタル入力をためす
本課題では以下の想定でソフトウェアを作成する。

- デジタル入力の 0 - 7 bit にリレー 1 - 8 を接続した。
- デジタル出力の 0 - 3 bit に LED 1 - 4 を接続した。
- リレーのチャタリングはないとする。
- リレー入力ありの場合，デジタル入力は 1 とする。
- デジタル出力の他の bit は何も接続されていないとする。

以下を満たすようなソフトウェアを作成する。
リレー入力から LED 出力までは 1ms の遅延を許容する。

- リレー 1 とリレー 2 の AND 出力が 1 のとき LED 1 を点灯，0のとき消灯
- リレー 3 とリレー 4 の  OR 出力が 1 のとき LED 2 を点灯，0のとき消灯
- リレー 5 とリレー 6 の XOR 出力が 1 のとき LED 3 を点灯，0のとき消灯
- リレー 1 からリレー 6 の OR 出力が 1 のとき LED 4 を点灯，0のとき消灯

このような論理はリレーだけでも構成できる。
今回はリレー点数を削減し，リレー論理の配線ミスを削減，リレー論理の確認時間を削減することを想定している。

`led-blink` 同様， `relay-logic-simple` に課題を用意してある。
`interrupt.c` を編集し， `make`， `make run` で動作を確認する。
リレー 1 - 8 の入力 (`*`が入力あり，`-`が入力なし)，LED 状態を割り込みごとに 1 行で表示する。
`make test` でソフトウェアテストを実施する。

